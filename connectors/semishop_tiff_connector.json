{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "SemiShop TIFF Connector",
  "description": "Connector mapping for TIFF files generated by SemiShop software (likely microscopy/inspection tool)",
  "type": "object",
  "tool_identification": {
    "software_signature": "SemiShop",
    "custom_tag_range": "32000-32140",
    "description": "Appears to be microscopy/inspection data with 20x magnification references"
  },
  "mappings": {
    "general_section": {
      "File Name": {
        "source": "filename",
        "extraction": "file_metadata",
        "description": "Extract from file path"
      },
      "File Size": {
        "source": "file_size", 
        "extraction": "file_metadata",
        "unit": "bytes"
      },
      "File Format": {
        "source": "format",
        "extraction": "pillow.basic_info.format",
        "expected_value": "TIFF"
      },
      "Image Width": {
        "source": ["pillow.width", "pillow.tags_v2.ImageWidth", "exifread.Image ImageWidth"],
        "extraction": "first_available",
        "unit": "pixels",
        "notes": "Multiple sources available, pillow.width is cleanest"
      },
      "Image Height": {
        "source": ["pillow.height", "pillow.tags_v2.ImageLength", "exifread.Image ImageLength"],
        "extraction": "first_available", 
        "unit": "pixels"
      },
      "Bit Depth": {
        "source": ["pillow.tags_v2.BitsPerSample", "exifread.Image BitsPerSample"],
        "extraction": "first_available",
        "transformation": "extract_numeric"
      },
      "Manufacturer": {
        "source": ["pillow.tags_v2.Make", "exifread.Image Make"],
        "extraction": "first_available",
        "notes": "May not be available in all files"
      },
      "Tool Name": {
        "source": ["pillow.tags_v2.Model", "exifread.Image Model"],
        "extraction": "first_available",
        "notes": "May not be available in all files"
      },
      "Software": {
        "source": ["exifread.Image Software", "pillow.tags_v2.Software"],
        "extraction": "first_available",
        "transformation": "clean_string",
        "notes": "exifread.Image Software is cleanest, pillow version has binary artifacts"
      },
      "Time Stamp": {
        "source": ["pillow.tags_v2.DateTime", "exifread.Image DateTime"],
        "extraction": "first_available",
        "transformation": "convert_to_iso8601",
        "notes": "Need to verify timestamp format and convert to ISO8601"
      },
      "Pixel Width": {
        "source": ["pillow.tags_v2.XResolution"],
        "extraction": "extract_and_convert",
        "transformation": "resolution_to_pixel_size",
        "unit": "nm",
        "notes": "Need to calculate from resolution and convert units"
      },
      "Pixel Height": {
        "source": ["pillow.tags_v2.YResolution"],
        "extraction": "extract_and_convert", 
        "transformation": "resolution_to_pixel_size",
        "unit": "nm",
        "notes": "Need to calculate from resolution and convert units"
      },
      "Color Mode": {
        "source": ["pillow.basic_info.mode", "pillow.tags_v2.PhotometricInterpretation"],
        "extraction": "map_color_mode",
        "transformation": "standardize_color_mode"
      }
    },
    "method_specific": {
      "notes": "Custom tags 32000-32140 likely contain method-specific data",
      "potential_mappings": {
        "magnification": {
          "source": "pillow.tags_v2.Tag_32015",
          "extraction": "extract_magnification",
          "notes": "Contains 'Camera=InGaAs 60 s x 1 Frm. 20.0x' - extract 20.0x"
        },
        "exposure_time": {
          "source": "pillow.tags_v2.Tag_32015",
          "extraction": "extract_exposure",
          "notes": "Contains '60 s' - extract exposure time"
        },
        "detector_type": {
          "source": "pillow.tags_v2.Tag_32015", 
          "extraction": "extract_detector",
          "notes": "Contains 'InGaAs' - detector type"
        },
        "current_measurement": {
          "source": "pillow.tags_v2.Tag_32013",
          "extraction": "extract_current",
          "notes": "Contains '1.60 [mA]' - likely probe or emission current"
        },
        "voltage_measurement": {
          "source": "pillow.tags_v2.Tag_32014",
          "extraction": "extract_voltage", 
          "notes": "Contains '0.02 [V]' - likely accelerating or bias voltage"
        }
      }
    },
    "tool_specific": {
      "SemiShop": {
        "all_custom_tags": {
          "source": "pillow.tags_v2.Tag_32*",
          "extraction": "preserve_all",
          "notes": "Preserve all custom tags for tool-specific analysis"
        },
        "coordinate_data": {
          "source": ["pillow.tags_v2.Tag_32094", "pillow.tags_v2.Tag_32095", "pillow.tags_v2.Tag_32096"],
          "extraction": "extract_coordinates",
          "notes": "Tags 32094-32096 contain 0.0 values - may be X,Y,Z coordinates"
        }
      }
    }
  },
  "transformations": {
    "clean_string": {
      "description": "Remove null bytes and binary artifacts from strings",
      "implementation": "strip_nulls_and_control_chars"
    },
    "extract_numeric": {
      "description": "Extract numeric value from string or tuple",
      "implementation": "parse_first_number"
    },
    "convert_to_iso8601": {
      "description": "Convert timestamp to ISO8601 format",
      "implementation": "datetime_to_iso8601"
    },
    "resolution_to_pixel_size": {
      "description": "Convert resolution (DPI) to pixel size in nm",
      "implementation": "dpi_to_nanometers"
    },
    "extract_magnification": {
      "description": "Extract magnification value from camera string",
      "implementation": "regex_extract_magnification"
    },
    "extract_exposure": {
      "description": "Extract exposure time from camera string",
      "implementation": "regex_extract_time"
    },
    "extract_current": {
      "description": "Extract current value and unit",
      "implementation": "regex_extract_measurement"
    },
    "extract_voltage": {
      "description": "Extract voltage value and unit", 
      "implementation": "regex_extract_measurement"
    }
  },
  "validation": {
    "required_fields": [
      "general_section.Image Width",
      "general_section.Image Height", 
      "general_section.Software"
    ],
    "optional_fields": [
      "general_section.Manufacturer",
      "general_section.Tool Name",
      "general_section.Time Stamp"
    ],
    "custom_validations": [
      "verify_software_signature",
      "validate_image_dimensions",
      "check_custom_tag_presence"
    ]
  },
  "notes": [
    "This connector is based on analysis of TIFF files with 'SemiShop' software signature",
    "Custom tags 32000-32140 contain proprietary metadata that needs manufacturer documentation",
    "Some values contain binary data mixed with text - careful parsing required",
    "Magnification appears to be 20x based on filename and tag content",
    "Detector appears to be InGaAs (Indium Gallium Arsenide) - likely infrared imaging",
    "Current and voltage measurements suggest this is an electron microscopy or similar tool"
  ]
}
